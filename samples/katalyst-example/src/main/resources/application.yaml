# Katalyst Example Application - Base Configuration
# This file is committed to git and contains:
# - Default values for all environments
# - Configuration structure documentation
# - Public, non-sensitive defaults
#
# Secrets are provided via environment variables:
# - ${DB_PASSWORD} → resolved from KATALYST_EXAMPLE_DB_PASSWORD env var
# - ${JWT_SECRET} → resolved from JWT_SECRET env var

ktor:
  deployment:
    # Network Configuration
    host: ${SERVER_HOST:0.0.0.0}
    port: ${SERVER_PORT:8081}
    #sslPort: ${SERVER_SSL_PORT:}  # Optional: set to enable HTTPS (e.g., 8443)

    # Shutdown Configuration
    shutdownGracePeriod: ${SHUTDOWN_GRACE_PERIOD:1000}      # ms
    shutdownTimeout: ${SHUTDOWN_TIMEOUT:5000}               # ms
    shutdownUrl: ${SHUTDOWN_URL:}                           # Optional: endpoint for graceful shutdown

    # Context & Routing
    #rootPath: ${ROOT_PATH:/}
    # watchPaths: []  # Optional: watch paths for auto-reload during development

    # Thread Pool Configuration (mainly Netty, but defined here for consistency)
    connectionGroupSize: ${CONNECTION_GROUP_SIZE:8}         # Threads for accepting connections
    workerGroupSize: ${WORKER_GROUP_SIZE:8}                 # Threads for message parsing
    callGroupSize: ${CALL_GROUP_SIZE:8}                     # Threads for application code

    # HTTP Protocol Limits
    maxInitialLineLength: ${MAX_INITIAL_LINE_LENGTH:4096}   # bytes
    maxHeaderSize: ${MAX_HEADER_SIZE:8192}                  # bytes
    maxChunkSize: ${MAX_CHUNK_SIZE:8192}                    # bytes

    # Timeout Configuration
    connectionIdleTimeoutMs: ${CONNECTION_IDLE_TIMEOUT:180000}  # 3 minutes, ms
    requestTimeoutMs: ${REQUEST_TIMEOUT:}                       # Optional: max time to process request

    # Jetty-specific Thread Pools (optional, ignored by other engines)
    maxThreads: ${MAX_THREADS:}                              # Optional: Jetty max threads
    minThreads: ${MIN_THREADS:}                              # Optional: Jetty min threads

  #security:
    #ssl:
      # SSL Configuration (only set if sslPort is configured above)
      # keyStore: "path/to/keystore.jks"
      # keyAlias: "server-alias"
      # keyStorePassword: ${SSL_KEY_STORE_PASSWORD:}
      # privateKeyPassword: ${SSL_PRIVATE_KEY_PASSWORD:}
      # Optional SSL provider and factory settings
      # provider: "SunX509"
      # keyManagerFactory: "SunX509"
      # trustManagerFactory: "SunX509"
      # trustStore: "path/to/truststore.jks"
      # trustStorePassword: ${SSL_TRUST_STORE_PASSWORD:}

# Database Configuration
# Environment variables: DB_URL, DB_USERNAME, DB_PASSWORD, DB_DRIVER
database:
  url: ${DB_URL:jdbc:postgresql://localhost:5432/postgres}
  username: ${DB_USERNAME:postgres}
  password: ${DB_PASSWORD:}
  driver: ${DB_DRIVER:org.postgresql.Driver}
  pool:
    maxSize: ${DB_MAX_POOL:10}
    minIdle: ${DB_MIN_IDLE:1}
    connectionTimeout: ${DB_TIMEOUT:30000}
    idleTimeout: ${DB_IDLE_TIMEOUT:600000}
    maxLifetime: ${DB_MAX_LIFETIME:1800000}

# JWT Configuration
# Environment variables: JWT_SECRET, JWT_ISSUER, JWT_AUDIENCE, JWT_REALM, JWT_EXPIRATION
jwt:
  secret: ${JWT_SECRET:local-secret-for-development-only}
  issuer: ${JWT_ISSUER:katalyst-example}
  audience: ${JWT_AUDIENCE:katalyst-users}
  realm: ${JWT_REALM:KatalystExample}
  expirationSeconds: ${JWT_EXPIRATION:3600}

# Application Environment
# Used by validators to apply environment-specific rules
app:
  environment: ${APP_ENVIRONMENT:development}
  debug: ${APP_DEBUG:true}
